<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Icons
        const ChevronLeft = () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="15 18 9 12 15 6"/></svg>;
        const ChevronRight = () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"/></svg>;
        const DollarSign = ({className}) => <svg className={className} width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>;
        const TrendingUp = () => <svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/></svg>;
        const Check = () => <svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>;
        const Settings = () => <svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m5.08 5.08l4.24 4.24M1 12h6m6 0h6M4.22 19.78l4.24-4.24m5.08-5.08l4.24-4.24"/></svg>;

        function App() {
            const weekdays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            const [currentDate, setCurrentDate] = useState(new Date());
            const [selectedDate, setSelectedDate] = useState(new Date());
            const [tasks, setTasks] = useState(() => JSON.parse(localStorage.getItem('tasks') || '{}'));
            const [taskNames, setTaskNames] = useState(() => {
                const saved = localStorage.getItem('taskNames');
                if (saved) return JSON.parse(saved);
                return {
                    weekday: {0:['Task 1','Task 2','Task 3','Task 4','Task 5'],1:['Task 1','Task 2','Task 3','Task 4','Task 5'],2:['Task 1','Task 2','Task 3','Task 4','Task 5'],3:['Task 1','Task 2','Task 3','Task 4','Task 5'],4:['Task 1','Task 2','Task 3','Task 4','Task 5'],5:['Task 1','Task 2','Task 3','Task 4','Task 5'],6:['Task 1','Task 2','Task 3','Task 4','Task 5']},
                    specific: {}
                };
            });
            const [bank, setBank] = useState(() => parseFloat(localStorage.getItem('bank') || '0'));
            const [transactions, setTransactions] = useState(() => JSON.parse(localStorage.getItem('transactions') || '[]'));
            const [showSpend, setShowSpend] = useState(false);
            const [spendAmt, setSpendAmt] = useState('');
            const [spendDesc, setSpendDesc] = useState('');
            const [tab, setTab] = useState('calendar');
            const [editMode, setEditMode] = useState('weekday');
            const [selWeekday, setSelWeekday] = useState(0);
            const [editDate, setEditDate] = useState(new Date());

            useEffect(() => localStorage.setItem('tasks', JSON.stringify(tasks)), [tasks]);
            useEffect(() => localStorage.setItem('taskNames', JSON.stringify(taskNames)), [taskNames]);
            useEffect(() => localStorage.setItem('bank', bank), [bank]);
            useEffect(() => localStorage.setItem('transactions', JSON.stringify(transactions)), [transactions]);

            const getNames = (d) => taskNames.specific[d.toDateString()] || taskNames.weekday[d.getDay()];
            const getColor = (ds) => {
                const t = tasks[ds];
                if (!t) return 'bg-white';
                const c = t.filter(x=>x).length;
                if (c===5) return 'bg-green-500 text-white';
                if (c>=3) return 'bg-yellow-400';
                if (c>=1) return 'bg-red-400';
                return 'bg-white';
            };

            const toggle = (i) => {
                const ds = selectedDate.toDateString();
                const curr = tasks[ds] || [false,false,false,false,false];
                const next = [...curr];
                next[i] = !next[i];
                setTasks(p => ({...p, [ds]: next}));
                const amt = next[i] ? 7 : -7;
                const newB = bank + amt;
                setBank(newB);
                setTransactions(p => [{date: new Date().toISOString(), type: next[i]?'earn':'refund', amount: amt, description: `${getNames(selectedDate)[i]} ${next[i]?'completed':'unchecked'}`, balance: newB}, ...p]);
            };

            const spend = () => {
                const a = parseFloat(spendAmt);
                if (isNaN(a) || a<=0) return alert('Invalid amount');
                if (a > bank) return alert('Insufficient funds');
                const newB = bank - a;
                setBank(newB);
                setTransactions(p => [{date: new Date().toISOString(), type: 'spend', amount: -a, description: spendDesc || 'Purchase', balance: newB}, ...p]);
                setShowSpend(false);
                setSpendAmt('');
                setSpendDesc('');
            };

            const getDays = () => {
                const y = currentDate.getFullYear();
                const m = currentDate.getMonth();
                const first = new Date(y, m, 1).getDay();
                const last = new Date(y, m+1, 0).getDate();
                const days = [];
                for(let i=0; i<first; i++) days.push(null);
                for(let i=1; i<=last; i++) days.push(new Date(y, m, i));
                return days;
            };

            const days = getDays();
            const ds = selectedDate.toDateString();
            const curr = tasks[ds] || [false,false,false,false,false];
            const names = getNames(selectedDate);

            return (
                <div className="min-h-screen bg-gray-50 p-4">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <div className="flex justify-between items-center mb-4">
                                <h1 className="text-3xl font-bold">Task Tracker</h1>
                                <div className="flex items-center gap-2 bg-green-100 px-4 py-2 rounded">
                                    <DollarSign className="text-green-600"/>
                                    <span className="text-2xl font-bold text-green-600">${bank.toFixed(2)}</span>
                                </div>
                            </div>
                            <div className="flex gap-2 border-b">
                                <button onClick={()=>setTab('calendar')} className={`px-4 py-2 ${tab==='calendar'?'border-b-2 border-blue-500 text-blue-600':'text-gray-500'}`}><Check/> Calendar</button>
                                <button onClick={()=>setTab('settings')} className={`px-4 py-2 ${tab==='settings'?'border-b-2 border-blue-500 text-blue-600':'text-gray-500'}`}><Settings/> Edit</button>
                                <button onClick={()=>setTab('transactions')} className={`px-4 py-2 ${tab==='transactions'?'border-b-2 border-blue-500 text-blue-600':'text-gray-500'}`}><TrendingUp/> History</button>
                            </div>
                        </div>

                        {tab==='calendar' && (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <div className="lg:col-span-2 bg-white rounded-lg shadow p-6">
                                    <div className="flex justify-between items-center mb-4">
                                        <div className="flex gap-2">
                                            <button onClick={()=>setCurrentDate(new Date(currentDate.getFullYear()-1,currentDate.getMonth(),1))} className="px-3 py-1 bg-gray-100 rounded">{'<<'}</button>
                                            <button onClick={()=>setCurrentDate(new Date(currentDate.getFullYear(),currentDate.getMonth()-1,1))} className="px-3 py-1 bg-gray-100 rounded"><ChevronLeft/></button>
                                        </div>
                                        <h2 className="text-xl font-bold">{currentDate.toLocaleString('default',{month:'long',year:'numeric'})}</h2>
                                        <div className="flex gap-2">
                                            <button onClick={()=>setCurrentDate(new Date(currentDate.getFullYear(),currentDate.getMonth()+1,1))} className="px-3 py-1 bg-gray-100 rounded"><ChevronRight/></button>
                                            <button onClick={()=>setCurrentDate(new Date(currentDate.getFullYear()+1,currentDate.getMonth(),1))} className="px-3 py-1 bg-gray-100 rounded">{'>>'}</button>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-7 gap-2">
                                        {['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].map(d=><div key={d} className="text-center font-semibold py-2">{d}</div>)}
                                        {days.map((d,i)=>{
                                            if(!d) return <div key={`e${i}`} className="aspect-square"/>;
                                            const dstr = d.toDateString();
                                            const isSel = dstr===ds;
                                            const isToday = dstr===new Date().toDateString();
                                            return <button key={dstr} onClick={()=>setSelectedDate(d)} className={`aspect-square rounded-lg flex items-center justify-center font-medium ${getColor(dstr)} ${isSel?'ring-4 ring-blue-500':''} ${isToday?'ring-2 ring-purple-400':''}`}>{d.getDate()}</button>;
                                        })}
                                    </div>
                                    <div className="mt-4 flex gap-4 text-sm">
                                        <div className="flex items-center gap-2"><div className="w-4 h-4 bg-green-500 rounded"/><span>5 tasks</span></div>
                                        <div className="flex items-center gap-2"><div className="w-4 h-4 bg-yellow-400 rounded"/><span>3-4 tasks</span></div>
                                        <div className="flex items-center gap-2"><div className="w-4 h-4 bg-red-400 rounded"/><span>1-2 tasks</span></div>
                                    </div>
                                </div>
                                <div className="bg-white rounded-lg shadow p-6">
                                    <h3 className="text-xl font-bold mb-4">{selectedDate.toLocaleDateString()}</h3>
                                    <div className="space-y-3 mb-6">
                                        {curr.map((c,i)=><label key={i} className="flex items-center gap-3 p-3 rounded bg-gray-50 hover:bg-gray-100 cursor-pointer"><input type="checkbox" checked={c} onChange={()=>toggle(i)} className="w-5 h-5"/><span className={c?'line-through text-gray-500':''}>{names[i]} {c&&'(+$7)'}</span></label>)}
                                    </div>
                                    <div className="border-t pt-4">
                                        <div className="text-sm text-gray-600">Completed: {curr.filter(t=>t).length}/5</div>
                                        <div className="text-sm font-medium text-green-600">Earned: ${(curr.filter(t=>t).length*7).toFixed(2)}</div>
                                    </div>
                                    <button onClick={()=>setShowSpend(true)} className="w-full mt-4 bg-blue-500 text-white py-2 px-4 rounded">Spend</button>
                                </div>
                            </div>
                        )}

                        {tab==='settings' && (
                            <div className="bg-white rounded-lg shadow p-6">
                                <h2 className="text-2xl font-bold mb-4">Edit Task Names</h2>
                                <div className="flex gap-2 mb-6">
                                    <button onClick={()=>setEditMode('weekday')} className={`px-4 py-2 rounded ${editMode==='weekday'?'bg-blue-500 text-white':'bg-gray-100'}`}>By Weekday</button>
                                    <button onClick={()=>setEditMode('specific')} className={`px-4 py-2 rounded ${editMode==='specific'?'bg-blue-500 text-white':'bg-gray-100'}`}>Specific Day</button>
                                </div>
                                {editMode==='weekday' && (
                                    <div>
                                        <select value={selWeekday} onChange={(e)=>setSelWeekday(parseInt(e.target.value))} className="w-full border rounded px-3 py-2 mb-4">
                                            {weekdays.map((n,i)=><option key={i} value={i}>{n}</option>)}
                                        </select>
                                        <div className="space-y-3">
                                            {taskNames.weekday[selWeekday].map((n,i)=><div key={i}><label className="block text-sm font-medium mb-1">Task {i+1}:</label><input type="text" value={n} onChange={(e)=>setTaskNames(p=>({...p,weekday:{...p.weekday,[selWeekday]:p.weekday[selWeekday].map((x,j)=>j===i?e.target.value:x)}}))} className="w-full border rounded px-3 py-2"/></div>)}
                                        </div>
                                    </div>
                                )}
                                {editMode==='specific' && (
                                    <div>
                                        <input type="date" value={editDate.toISOString().split('T')[0]} onChange={(e)=>setEditDate(new Date(e.target.value+'T00:00:00'))} className="w-full border rounded px-3 py-2 mb-4"/>
                                        {taskNames.specific[editDate.toDateString()] && <button onClick={()=>setTaskNames(p=>{const ns={...p.specific}; delete ns[editDate.toDateString()]; return {...p,specific:ns};})} className="w-full mb-3 bg-red-100 text-red-600 py-2 rounded text-sm">Reset to {weekdays[editDate.getDay()]} Default</button>}
                                        <div className="space-y-3">
                                            {getNames(editDate).map((n,i)=><div key={i}><label className="block text-sm font-medium mb-1">Task {i+1}:</label><input type="text" value={n} onChange={(e)=>{const ds=editDate.toDateString(); const dw=editDate.getDay(); const cn=taskNames.specific[ds]||[...taskNames.weekday[dw]]; setTaskNames(p=>({...p,specific:{...p.specific,[ds]:cn.map((x,j)=>j===i?e.target.value:x)}}));}} className="w-full border rounded px-3 py-2"/></div>)}
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {tab==='transactions' && (
                            <div className="bg-white rounded-lg shadow p-6">
                                <h2 className="text-2xl font-bold mb-4">History</h2>
                                {transactions.length===0 ? <p className="text-gray-500 text-center py-8">No transactions</p> : (
                                    <div className="space-y-2">
                                        {transactions.map((t,i)=><div key={i} className={`p-4 rounded border-l-4 ${t.type==='earn'?'border-green-500 bg-green-50':t.type==='spend'?'border-red-500 bg-red-50':'border-gray-500 bg-gray-50'}`}><div className="flex justify-between"><div><div className="font-medium">{t.description}</div><div className="text-sm text-gray-500">{new Date(t.date).toLocaleString()}</div></div><div className="text-right"><div className={`font-bold ${t.amount>0?'text-green-600':'text-red-600'}`}>{t.amount>0?'+':''}${Math.abs(t.amount).toFixed(2)}</div><div className="text-sm text-gray-500">Balance: ${t.balance.toFixed(2)}</div></div></div></div>)}
                                    </div>
                                )}
                            </div>
                        )}

                        {showSpend && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-lg p-6 max-w-md w-full">
                                    <h3 className="text-xl font-bold mb-4">Spend from TCG Bank</h3>
                                    <div className="mb-4"><label className="block text-sm font-medium mb-2">Amount ($)</label><input type="number" step="0.01" value={spendAmt} onChange={(e)=>setSpendAmt(e.target.value)} className="w-full border rounded px-3 py-2" placeholder="0.00"/></div>
                                    <div className="mb-4"><label className="block text-sm font-medium mb-2">What did you buy?</label><input type="text" value={spendDesc} onChange={(e)=>setSpendDesc(e.target.value)} className="w-full border rounded px-3 py-2" placeholder="Card name"/></div>
                                    <div className="text-sm text-gray-600 mb-4">Available: ${bank.toFixed(2)}</div>
                                    <div className="flex gap-2">
                                        <button onClick={()=>setShowSpend(false)} className="flex-1 bg-gray-200 py-2 rounded">Cancel</button>
                                        <button onClick={spend} className="flex-1 bg-red-500 text-white py-2 rounded">Confirm</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App/>, document.getElementById('root'));
    </script>
</body>
</html>
